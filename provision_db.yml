#
---

- hosts: db
  gather_facts: yes
  become: true

  tasks:
  - name: update
    shell:
      cmd: apt-get update -y

  - name: upgrade
    shell:
      cmd: apt-get upgrade -y
  
  - name: wget
   shell:
     cmd: runuser -l ubuntu -c 'wget -qO - https://www.mongodb.org/static/pgp/server-3.2.asc | sudo apt-key add -'
  
  - name: mongod
    shell: 
      cmd: runuser -l ubuntu -c 'echo "deb http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.2 multiverse" >> /etc/apt/sources.list.d/mongodb-org-3.2.list'
  
  - name: update 2
    shell:
      cmd: apt-get update -y
      
  - name: Install mongod
    shell: 
      cmd: sudo apt-get install -y mongodb-org=3.2.20 mongodb-org-server=3.2.20 mongodb-org-shell=3.2.20 mongodb-org-mongos=3.2.20 mongodb-org-tools=3.2.20
  
  - name: make dir
    file:
      state: directory
      path: /data/db
      
  - name: Change file permission
    file:
      path: /var/lib/mongodb
      owner: mongodb

  - name: replace ip in mongo
    shell:
      cmd: sudo sed -i 's/127.0.0.1/0.0.0.0/g' /etc/mongod.conf
      
  - name: Enable mondod
    service: name=mongod state=restarted enabled=yes
      
